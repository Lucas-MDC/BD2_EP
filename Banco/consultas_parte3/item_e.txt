select 
	maquina.nome_produto,
	maquina.preco_produto,
	sum(p.preco_produto * tp.qtd_peca)
from
	produto maquina
inner join Tem_Peca tp 
	on tp.fk_produto_id_produto = maquina.id_produto
inner join produto p 
	on tp.fk_produto_id_produto_ = p.id_produto
inner join tipo_produto tprod
	on p.fk_tipo_produto_id_tipo = tprod.id_tipo
group by
	maquina.nome_produto, maquina.preco_produto
order by
	sum(p.preco_produto * tp.qtd_peca) desc;